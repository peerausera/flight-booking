{% load static %}
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/cpe.css' %}">
</head>

<body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <ul class="navbar-nav mb-0 ">
            <li class="nav-item">
                <a class="nav-link" href="/FlightManagement">Flight Management</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/ReportListAllFlight"> List All Flight</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/ListAllTicket"> List All Ticket</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/ListAllCustomer"> List All Customer</a>
            </li>
        </ul>
    </nav>
    <br />
    <form id='form_get' action='/ListAllTicket/get' method='GET'>
        <label>Ticket ID</label>
        <input type='text' name='ticket_id' value=''>
        <input type='submit' value='GET'>
    </form>

    <button id='btnTicketList'>Ticket List </button>

    <table id='TicketList' class='table'>
        <thead>
            <tr>
                <th class='col-1'>#</th>
                <th class='col-2'>Ticket ID</th>
                <th class='col-2'>Flight ID</th>
                <th class='col-3'>Flight Class</th>
                <th class='col-3'>Seat</th>
                <th class='col-3'>Username</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for list in ticket %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ list.ticket_id }}</td>
                <td>{{ list.flightid_id }}</td>
                <td>{{ list.flight_class_id }}</td>
                <td>{{ list.seat }}</td>
                <td>{{ list.username_id }}</td>
                <td><input type='button' class='btnDelTicket' value='Del'></td>
            <tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            $('#btnTicketList').click(function () {

                $.ajax({
                    url: '/ListAllTicket/list',
                    type: 'get',
                    dataType: 'json',
                    success: function (data) {
                        let rows = '';
                        var i = 1;
                        data.data.forEach(list => {
                            rows += `
                                    <tr>
                                        <td>${i++}</td>
                                        <td>${list.ticket_id}</td>
                                        <td>${list.flightid_id}</td>
                                        <td>${list.flight_class_id}</td>
                                        <td>${list.seat}</td>
                                        <td>${list.username_id}</td>  
                                        <td><input type='button' class='btnDelTicket' value='Del'></td>
                                    </tr>`;
                        });
                        $('#TicketList > tbody').html(rows);
                    },
                });
            });


            $(document).on("click", ".btnDelTicket", function () {

                var ticket_id = $(this).parents('tr').find('td:nth-child(2)').html();
                var token = $('[name=csrfmiddlewaretoken]').val();
                $.ajax({
                    url: '/ListAllTicket/delete',
                    type: 'post',
                    data: 'ticket_id=' + ticket_id,
                    headers: { "X-CSRFToken": token },
                    dataType: 'json',
                    success: function (data) {
                        let rows = '';
                        var i = 1;
                        data.ticket.forEach(listitem => {
                            rows += `
                                    <tr>
                                        <td>${i++}</td>
                                        <td>${listitem.ticket_id}</td>
                                        <td>${listitem.flightid_id}</td>
                                        <td>${listitem.flight_class_id}</td>
                                        <td>${listitem.seat}</td>
                                        <td>${listitem.username_id}</td>  
                                        <td><input type='button' class='btnDelTicket' value='Del'></td>
                                    </tr>`;
                        });
                        $('#TicketList > tbody').html(rows);
                    },
                });

            });

        });
    </script>


</body>

</html>